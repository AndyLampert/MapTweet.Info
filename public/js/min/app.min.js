"use strict";

function onGoogleReady() {
    angular.bootstrap(document.body, [ "glutApp" ]);
}

var glutApp = angular.module("glutApp", [ "ngResource", "ngRoute", "glutSearchControllers", "glutResultsControllers", "glutHistoryControllers", "glutLatLngServices", "glutTwitterSearchServices", "glutMapServices", "glutHistoryServices", "ui.bootstrap", "ui.map" ]);

glutApp.config([ "$routeProvider", function(a) {
    a.when("/", {
        templateUrl: "partials/search",
        controller: "searchCtrl"
    }).when("/search/:searchId", {
        templateUrl: "partials/searchResults",
        controller: "resultsCtrl"
    }).when("/history", {
        templateUrl: "partials/history",
        controller: "historyCtrl"
    }).otherwise({
        redirectTo: "/"
    });
} ]), $(document).ready(function() {
    $(document).on("click", "[data-toggle=offcanvas]", function() {
        $(".row-offcanvas").toggleClass("active");
    });
});

var glutHistoryControllers = angular.module("glutHistoryControllers", []);

glutHistoryControllers.controller("historyCtrl", [ "$scope", "historyFactory", function(a, b) {
    a.user = {}, b.retrieveSearchHistory().then(function(b) {
        console.log("got this back-", b), a.user = b;
    }), a.performSearch = function(a) {
        b.performSearch(a._id);
    }, a.copyToSearch = function(a) {
        b.copyToSearch(a);
    }, a.removeSearch = function() {};
} ]);

var glutResultsControllers = angular.module("glutResultsControllers", []);

glutResultsControllers.controller("resultsCtrl", [ "$scope", "$routeParams", "factoryTwitterSearch", "markerFactory", function(a, b, c, d) {
    a.mapOptions = {
        center: new google.maps.LatLng(20, -30),
        zoom: 2,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        streetViewControl: !1,
        panControl: !1,
        zoomControl: !0,
        scaleControl: !1,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL,
            position: google.maps.ControlPosition.LEFT_BOTTOM
        },
        mapTypeControl: !0,
        mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position: google.maps.ControlPosition.RIGHT_BOTTOM
        }
    }, a.myMarkers = [], a.currentMarkerInfo = {}, a.currentMarkerInfo.user = {}, a.searchId = b.searchId, 
    a.search = {}, a.results = {}, a.results.tweets = [], a.results.geoTweets = [], 
    a.results.returned = !1, c.getTweetsBySearchId(b.searchId).then(function(b) {
        console.log("recieved-", b), a.search = b.search, d.setMyMap(a.myMap), a.results.tweets = b.statuses, 
        a.results.geoTweets = a.results.tweets.filter(function(a) {
            return null != a.geo;
        });
        for (var c = 0; c < a.results.geoTweets.length; c++) {
            var e = d.createAndAddMarker(a.results.geoTweets[c].geo[0], a.results.geoTweets[c].geo[1]);
            a.results.geoTweets[c].marker = e, a.myMarkers.push(a.results.geoTweets[c].marker);
        }
    }).then(function() {
        if (0 == a.results.geoTweets.length) a.myMap.setCenter({
            lat: +a.search.latitude,
            lng: +a.search.longitude
        }), a.myMap.setZoom(14), a.results.returned = !0; else {
            a.results.returned = !0;
            var b = new google.maps.LatLngBounds();
            a.myMarkers.forEach(function(a) {
                b.extend(a.getPosition());
            }), a.myMap.setCenter(b.getCenter()), a.myMap.fitBounds(b), a.myMap.getZoom() >= 17 && a.myMap.setZoom(16);
        }
    }), a.openMarkerInfo = function(b) {
        a.currentMarkerInfo.marker = b;
        var c = a.results.geoTweets.filter(function(a) {
            return a.marker == b;
        })[0];
        a.currentMarkerInfo.user.screen_name = c.user.screen_name, a.currentMarkerInfo.text = c.text, 
        a.myInfoWindow.open(a.myMap, b);
    }, a.panToMarkerOpenInfo = function(b) {
        a.currentMarkerInfo.user.screen_name = b.user.screen_name, a.currentMarkerInfo.text = b.text, 
        a.currentMarkerInfo.marker = b.marker, a.myInfoWindow.open(a.myMap, b.marker), a.myMap.panTo(b.marker.getPosition());
    };
} ]);

var glutSearchControllers = angular.module("glutSearchControllers", []);

glutSearchControllers.controller("searchCtrl", [ "$scope", "$location", "factoryLatLng", "factoryTwitterSearch", function(a, b, c, d) {
    a.search = {}, a.search.location = "", a.search.radius = "10", a.search.radiusUnit = "Km", 
    a.search.useCurrentLocation = "Use My Current Location", a.search.usedCurrentLocation = !1, 
    a.search.retrievingCurrentLoc = !1;
    for (var e in b.search()) b.search().hasOwnProperty(e) && (a.search[e] = b.search()[e]);
    a.changeRadiusUnit = function(b) {
        a.search.radiusUnit = b;
    }, a.getGeo = function(b) {
        c.getLatLng(b).then(function(b) {
            a.search.latitude = b.lat, a.search.longitude = b.lng;
        });
    }, a.queryLocations = function(a) {
        return c.queryLocations(a);
    }, a.getCurrentLocation = function() {
        a.search.retrievingCurrentLoc = !0, a.search.useCurrentLocation = "Retrieving Current Location...", 
        c.getCurrentLocation(function(b) {
            b.notSupported ? a.search.useCurrentLocation = "Unable to use My Location" : (c.reverseGeocode(b.latitude, b.longitude, function(b) {
                a.search.location = b, a.$apply();
            }), a.search.latitude = b.latitude, a.search.longitude = b.longitude, a.search.usedCurrentLocation = !0, 
            a.search.retrievingCurrentLoc = !1, a.search.useCurrentLocation = "Use My Current Location", 
            a.$apply());
        });
    }, a.submitSearch = function() {
        d.postTwitterSearch(a.search);
    };
} ]);

var glutHistoryServices = angular.module("glutHistoryServices", []);

glutHistoryServices.factory("historyFactory", [ "$http", "$location", function(a, b) {
    return {
        retrieveSearchHistory: function() {
            return a.get("/api/search/history").then(function(a) {
                return a.data;
            });
        },
        copyToSearch: function(a) {
            b.path("/").search({
                location: a.location,
                radius: a.radius,
                radiusUnit: a.radiusUnit,
                query: a.query,
                latitude: a.latitude,
                longitude: a.longitude
            });
        },
        performSearch: function(a) {
            b.path("/search/" + a);
        },
        removeSearch: function() {}
    };
} ]);

var glutLatLngServices = angular.module("glutLatLngServices", []);

glutLatLngServices.factory("factoryLatLng", [ "$http", function(a) {
    return {
        reverseGeocode: function(a, b, c) {
            var d = new google.maps.Geocoder(), e = new google.maps.LatLng(+a, +b);
            d.geocode({
                latLng: e
            }, function(a, b) {
                if (b == google.maps.GeocoderStatus.OK) {
                    if (a[1]) return void c(a[1].formatted_address);
                    c(a[0].formatted_address);
                }
            });
        },
        getLatLng: function(b) {
            return a.get("http://maps.googleapis.com/maps/api/geocode/json", {
                params: {
                    address: b,
                    sensor: !1
                }
            }).then(function(a) {
                return a.data.results[0].geometry.location;
            });
        },
        queryLocations: function(b) {
            return a.get("http://maps.googleapis.com/maps/api/geocode/json", {
                params: {
                    address: b,
                    sensor: !1
                }
            }).then(function(a) {
                var b = [];
                return angular.forEach(a.data.results, function(a) {
                    b.push(a.formatted_address);
                }), b;
            });
        },
        getCurrentLocation: function(a) {
            navigator.geolocation ? navigator.geolocation.getCurrentPosition(function(b) {
                a(b.coords);
            }) : a({
                notSupported: !0
            });
        }
    };
} ]);

var glutMapServices = angular.module("glutMapServices", []);

glutMapServices.factory("markerFactory", [ function() {
    var a = null;
    return {
        setMyMap: function(b) {
            a = b;
        },
        createAndAddMarker: function(b, c) {
            var d = new google.maps.Marker({
                map: a,
                position: new google.maps.LatLng(b, c),
                icon: "../../img/bird_blue_32.png"
            });
            return d;
        },
        getMyMap: function() {
            return a;
        }
    };
} ]);

var glutTwitterSearchServices = angular.module("glutTwitterSearchServices", []);

glutTwitterSearchServices.factory("factoryTwitterSearch", [ "$http", "$location", function(a, b) {
    return {
        postTwitterSearch: function(c) {
            a.post("/api/search", c).success(function(a) {
                var c = a._id;
                b.path("/search/" + c);
            });
        },
        getTweetsBySearchId: function(b) {
            return a.get("/api/search?searchId=" + b).then(function(a) {
                return a.data;
            });
        }
    };
} ]);
//# sourceMappingURL=app.min.map